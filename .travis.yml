---

sudo: required
dist: trusty
language: python
python: "2.7"



env:

  - ANSIBLE_VERSION=latest
  - ANSIBLE_VERSION=2.2.2.0
  - ANSIBLE_VERSION=2.1.5
  - ANSIBLE_VERSION=2.0.0.2



branches:
  only:
    - features/install-utilities



before_install:
  - sudo apt-get update -qq
  - sudo adduser pi



install:

  # Install Ansible.
  - if [ "$ANSIBLE_VERSION" = "latest" ]; then pip install ansible; else pip install ansible==$ANSIBLE_VERSION; fi
  - if [ "$ANSIBLE_VERSION" = "latest" ]; then pip install ansible-lint; fi



script:

  # Check the 'common' role SYNTAX in playbook
  - ansible-playbook custom-setup.yml --syntax-check

  # Check the 'nodejs' role SYNTAX in playbook
  - ansible-playbook nodejs-setup.yml --syntax-check  

  # Check the 'docker' role SYNTAX in playbook
  - ansible-playbook docker-setup.yml --syntax-check    

  # Run the ansible-playbook to check 'common' ROLE
  - ansible-playbook custom-setup.yml -vvvv

  # Run the ansible-playbook to check 'nodejs' ROLE
  - ansible-playbook nodejs-setup.yml -vvvv

  # Run the ansible-playbook to check 'docker' ROLE
  - ansible-playbook docker-setup.yml -vvvv

  

  # check LOCAL TIMEZONE is set to 'Europe/Amsterdam'
  - cat /etc/timezone | grep -q "Europe/Amsterdam" && (echo "Timezone not set" && exit 1) || (echo "Timezone set to Europe-Amsterdam" && exit 0)

  # check 'dnsutils' OS PACKAGE is INSTALLED
  - dpkg -l | grep "dnsutils" &>/dev/null && (echo "Package: dnsutils Status: Installed Check: PASSED" && exit 0) || (echo "Package: dnsutils Status: Not found Check: FAILED" && exit 1)

  # check 'vim' OS PACKAGE is INSTALLED
  - dpkg -l | grep "vim" &>/dev/null && (echo "Package: vim Status: Installed Check: PASSED" && exit 0) || (echo "Package: vim Status: Not found Check: FAILED" && exit 1)

  # check 'tree' OS PACKAGE is INSTALLED
  - dpkg -l | grep "tree" &>/dev/null && (echo "Package: tree Status: Installed Check: PASSED" && exit 0) || (echo "Package: tree Status: Not found Check: FAILED" && exit 1)

  # check 'tightvncserver' OS PACKAGE is INSTALLED
  - dpkg -l | grep "tightvncserver" &>/dev/null && (echo "Package: tightvncserver Status: Installed Check: PASSED" && exit 0) || (echo "Package: tightvncserver Status: Not found Check: FAILED" && exit 1)

  # check 'locate' OS PACKAGE is INSTALLED
  - dpkg -l | grep "locate" &>/dev/null && (echo "Package: locate Status: Installed Check: PASSED" && exit 0) || (echo "Package: locate Status: Not found Check: FAILED" && exit 1)

  # check 'dos2unix' OS PACKAGE is INSTALLED
  - dpkg -l | grep "dos2unix" &>/dev/null && (echo "Package: dnsutils Status: Installed Check: PASSED" && exit 0) || (echo "Package: dnsutils Status: Not found Check: FAILED" && exit 1)
